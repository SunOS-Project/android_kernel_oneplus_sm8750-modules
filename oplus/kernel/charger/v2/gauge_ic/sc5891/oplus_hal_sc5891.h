// SPDX-License-Identifier: GPL-2.0-only
/*
 * Copyright (C) 2022-2023 Oplus. All rights reserved.
 */

#ifndef OPLUS_HAL_SC5891_H
#define OPLUS_HAL_SC5891_H

#define SC5891_TANSFER_DATA_LEN	(256UL)
#define SC5891_ROMID_VENDOR	(0xA0)
#define SC5891_ROMID_CID	(0x61)

enum {
	SC5891_INFO_LEN_ROMID		= 8,
	SC5891_INFO_LEN_CHALLENGE	= 12,
	SC5891_INFO_LEN_PRIVATE_KEY	= 32,
	SC5891_INFO_LEN_PUBLIC_KEY	= 64,
	SC5891_INFO_LEN_CERT		= 64,
	SC5891_INFO_LEN_SIGN		= 64,
	SC5891_INFO_PAGE_NUM		= 16,
	SC5891_INFO_PAGE_SIZE		= 16,
};

union sc5891_romid {
	uint64_t value;
	struct {
		uint64_t dev_series	:40;
		uint64_t ven_code	:8;
		uint64_t cid		:8;
		uint64_t crc		:8;
	};
	struct {
		uint32_t low_half;
		uint32_t high_half;
	};
};

enum {
	SC5891_PROTECT_STATUS_RP	= 0x01,
	SC5891_PROTECT_STATUS_WP	= 0x02,
	SC5891_PROTECT_STATUS_AUTH	= 0x20,
	SC5891_PROTECT_STATUS_ECW	= 0x80,
};

struct sc5891_tansfer_data {
	union {
		uint8_t expect_len;
		uint8_t len;	/* size(cmd) + size(data) */
	};
	union {
		uint8_t cmd;
		uint8_t result;
	};
	uint8_t data[SC5891_TANSFER_DATA_LEN];
};

enum SC5891_RESULT {
	SC5891_RESULT_SUCCESS			= 0xAA,
	SC5891_RESULT_CMD_NOT_SUPPORT		= 0X11,
	SC5891_RESULT_PARAM_ERROR		= 0X22,
	SC5891_RESULT_ACCESS_LIMIT		= 0X33,
	SC5891_RESULT_HARD_CRC_ERROR		= 0X44,
	SC5891_RESULT_DEVICE_BUSY		= 0X55,
	SC5891_RESULT_PRE_STEP_NOT_READY	= 0x66,
	SC5891_RESULT_ECDSA_FAIL		= 0x77,
	SC5891_RESULT_ECDSA_DISABLE		= 0x88,
	SC5891_RESULT_SOFT_CRC_ERROR		= 0XAB,
	SC5891_RESULT_I2C_FAIL			= 0XAC,
	SC5891_RESULT_RECV_LEN_NOT_MATCH	= 0XAD,
	SC5891_RESULT_ECW_GEN_SIGN_FAIL		= 0XAE,
	SC5891_RESULT_READ_CHECKSUM_FAIL	= 0xAF,
};

enum {
	SC5891_CMD_LOCK			= 0x15,
	SC5891_CMD_READ_MEMORY		= 0x30,
	SC5891_CMD_WRITE_MEMORY		= 0x31,
	SC5891_CMD_PROTECTION_STATUS	= 0x32,
	SC5891_CMD_SET_PROTECTION_TYPE	= 0x38,
	SC5891_CMD_GET_CERTIFICATION	= 0x40,
	SC5891_CMD_ECDSA		= 0x41,
	SC5891_CMD_GET_ROMID		= 0x42,
	SC5891_CMD_ECW			= 0x43,
	SC5891_CMD_SHUTDOWN		= 0x58,
	SC5891_CMD_MAX,
};

enum {
	SC5891_CNT_CMD_DEC = 1 << 6,
	SC5891_CNT_ECDSA_DEC = 1 << 4,
	SC5891_CNT_0_DIS_ECDSA = 1 << 2,
	SC5891_0_NO_OP = 1,
};

enum {
	SC5891_EXPECT_RECV_LEN_LOCK		= 2,
	SC5891_EXPECT_RECV_LEN_READ_MEMORY	= 17,
	SC5891_EXPECT_RECV_LEN_WRITE_MEMORY	= 2,
	SC5891_EXPECT_RECV_LEN_GET_PROTECTION	= 2,
	SC5891_EXPECT_RECV_LEN_SET_PROTECTION	= 2,
	SC5891_EXPECT_RECV_LEN_GET_CERT		= 129,
	SC5891_EXPECT_RECV_LEN_ECDSA		= 65,
	SC5891_EXPECT_RECV_LEN_GET_ROMID	= 9,
	SC5891_EXPECT_RECV_LEN_ECW		= 2,
};

enum {
	SC5891_CMD_SEND_LEN_LOCK		= 2,
	SC5891_CMD_SEND_LEN_READ_MEMORY		= 2,
	SC5891_CMD_SEND_LEN_WRITE_MEMORY	= 18,
	SC5891_CMD_SEND_LEN_GET_PROTECTION	= 2,
	SC5891_CMD_SEND_LEN_SET_PROTECTION	= 3,
	SC5891_CMD_SEND_LEN_GET_CERT		= 1,
	SC5891_CMD_SEND_LEN_ECDSA		= 13,
	SC5891_CMD_SEND_LEN_GET_ROMID		= 1,
	SC5891_CMD_SEND_LEN_ECW			= 77,
	SC5891_CMD_SEND_LEN_SHUTDOWN		= 1,
};

#endif /* OPLUS_HAL_SC5891_H */
